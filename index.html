<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DISPOSITIVO PARANORMAL v2.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Creepster&family=Special+Elite&family=Nosifer&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <style>
        /* --- VARIÁVEIS DE TEMA --- */
        :root {
            /* Padrão: Morte (Neutro/Escuro) */
            --bg-color: #050505;
            --primary: #666;       /* Cinza Médio */
            --secondary: #222;     /* Cinza Escuro */
            --highlight: #fff;     /* Branco */
            --text: #ccc;
            --border: #444;
            --dice-bg: #0a0a0a;
            --dice-hover: #333;
            --shadow-color: rgba(255, 255, 255, 0.1);
        }

        /* TEMA: SANGUE */
        body.theme-sangue {
            --bg-color: #1a0000;
            --primary: #ff0000;
            --secondary: #8a0303;
            --highlight: #ffcccc;
            --text: #ffb3b3;
            --border: #8a0303;
            --dice-bg: #2a0505;
            --dice-hover: #600;
            --shadow-color: rgba(255, 0, 0, 0.3);
        }

        /* TEMA: ENERGIA */
        body.theme-energia {
            --bg-color: #0a0015;
            --primary: #9b30ff;
            --secondary: #4b0082;
            --highlight: #00ffff;
            --text: #e0ccff;
            --border: #9b30ff;
            --dice-bg: #120024;
            --dice-hover: #2a0052;
            --shadow-color: rgba(155, 48, 255, 0.3);
        }

        /* TEMA: CONHECIMENTO */
        body.theme-conhecimento {
            --bg-color: #151000;
            --primary: #d4af37;
            --secondary: #8c7000;
            --highlight: #ffd700;
            --text: #fff8cc;
            --border: #b8860b;
            --dice-bg: #1f1a05;
            --dice-hover: #8c7000;
            --shadow-color: rgba(212, 175, 55, 0.3);
        }

        /* TEMA: MEDO */
        body.theme-medo {
            --bg-color: #f0f0f0; /* Invertido */
            --primary: #000;
            --secondary: #333;
            --highlight: #000;
            --text: #111;
            --border: #000;
            --dice-bg: #ddd;
            --dice-hover: #bbb;
            --shadow-color: rgba(0, 0, 0, 0.2);
        }

        /* --- ESTILOS GERAIS --- */
        body {
            background-color: var(--bg-color);
            color: var(--text);
            font-family: 'Special Elite', monospace;
            min-height: 100vh;
            overflow-x: hidden;
            display: flex; flex-direction: column; items-center;
            padding: 1rem;
            transition: background-color 0.5s, color 0.5s;
        }

        /* Seletor de Tema no Canto */
        .theme-switcher {
            position: absolute; top: 1rem; right: 1rem;
            z-index: 100; display: flex; align-items: center; gap: 0.5rem;
            background: rgba(0,0,0,0.8); padding: 5px 10px; border-radius: 5px;
            border: 1px solid var(--border);
        }
        .theme-switcher select {
            background: transparent; border: none; color: var(--highlight);
            font-family: 'Share Tech Mono', monospace; font-size: 0.8rem;
            cursor: pointer; outline: none;
        }

        /* Fundo Texturizado */
        .bg-texture {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            opacity: 0.1; pointer-events: none;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23888888' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        h1 { 
            font-family: 'Nosifer', cursive; color: var(--primary); 
            text-shadow: 0 0 10px var(--shadow-color);
            transition: all 0.5s;
        }
        h2 { font-family: 'Share Tech Mono', monospace; letter-spacing: 4px; color: var(--highlight); opacity: 0.8; }

        /* Container Principal */
        .device-container {
            width: 100%; max-width: 800px; margin: 3rem auto 0;
            border: 2px solid var(--border);
            background: rgba(10, 10, 10, 0.9);
            backdrop-filter: blur(5px);
            padding: 2rem;
            box-shadow: 0 0 30px var(--shadow-color);
            position: relative; overflow: hidden;
            z-index: 10;
            transition: all 0.5s;
        }
        body.theme-medo .device-container { background: rgba(255,255,255,0.8); }

        /* Botões de Dados */
        .dice-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(70px, 1fr)); gap: 1rem; }

        .dice-btn {
            background: var(--dice-bg); border: 1px solid var(--border); color: var(--text);
            padding: 1rem; cursor: pointer; transition: all 0.1s;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            clip-path: polygon(10% 0, 100% 0, 100% 90%, 90% 100%, 0 100%, 0 10%);
            height: 80px;
            position: relative;
        }

        .dice-btn:hover { 
            background: var(--dice-hover); color: var(--highlight); border-color: var(--highlight); 
            transform: translateY(-2px); 
            box-shadow: 0 0 15px var(--shadow-color); 
        }
        .dice-btn:active { transform: scale(0.95); }
        .dice-icon { font-size: 1.5rem; margin-bottom: 5px; }

        /* Inputs e Selects de Configuração */
        .config-input, .config-select {
            background: var(--dice-bg); border: 1px solid var(--border); color: var(--highlight);
            padding: 0.5rem; font-family: 'Share Tech Mono', monospace; text-align: center;
            outline: none; text-transform: uppercase; font-weight: bold; width: 100%;
        }
        .config-input:focus, .config-select:focus { border-color: var(--highlight); }
        
        /* Pool Display */
        .pool-display {
            background: var(--bg-color); border: 1px solid var(--border);
            padding: 0.8rem; font-family: 'Share Tech Mono', monospace;
            color: var(--highlight); font-size: 1.2rem; 
            display: flex; justify-content: space-between; align-items: center;
            margin-top: 0.5rem; min-height: 3rem;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }
        .pool-clear { color: var(--primary); cursor: pointer; font-size: 0.8rem; padding-left: 10px; border-left: 1px solid var(--border); }
        .pool-clear:hover { color: var(--highlight); }

        /* Botão Conjurar */
        .action-btn {
            width: 100%; padding: 1rem; margin-top: 1.5rem;
            background: var(--secondary); color: var(--highlight); border: 1px solid var(--primary);
            font-family: 'Creepster', cursive; font-size: 1.8rem; letter-spacing: 3px;
            cursor: pointer; text-transform: uppercase; transition: all 0.3s;
            position: relative; overflow: hidden;
        }
        .action-btn:hover { 
            background: var(--primary); box-shadow: 0 0 30px var(--shadow-color); 
            color: #fff;
        }

        /* Resultado */
        .result-area {
            margin-top: 2rem; border: 2px solid var(--primary); background: var(--bg-color);
            padding: 1.5rem; text-align: center; min-height: 120px;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: border-color 0.3s;
        }
        .result-val { 
            font-family: 'Nosifer', cursive; font-size: 4rem; color: var(--highlight); 
            text-shadow: 0 0 20px var(--shadow-color);
        }
        .result-breakdown { font-family: 'Share Tech Mono', monospace; color: var(--text); opacity: 0.8; margin-top: 0.5rem; }

        /* Logs */
        .log-container {
            max-width: 800px; margin: 1rem auto; height: 200px; overflow-y: auto;
            background: rgba(0,0,0,0.9); border: 1px solid var(--border); padding: 1rem;
            font-family: 'Share Tech Mono', monospace; font-size: 0.9rem;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        body.theme-medo .log-container { background: #fff; border: 1px solid #000; }

        .log-entry { 
            border-left: 4px solid var(--primary); padding: 5px 10px; margin-bottom: 5px; 
            border-bottom: 1px dashed var(--border);
        }
        .log-tag { font-weight: bold; font-size: 0.8rem; padding: 2px 6px; border-radius: 3px; color: #000; display: inline-block; margin-bottom: 4px; }

        /* Cores das Tags Específicas (Independente do Tema) */
        .tag-mundano { background: #ccc; }
        .tag-morte { background: #444; color: #fff; }
        .tag-sangue { background: #ff0000; color: #fff; }
        .tag-energia { background: #9b30ff; color: #fff; }
        .tag-conhecimento { background: #ffd700; }
        .tag-mental { background: #00ffff; }
        .tag-medo { background: #000; color: #fff; }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-color); }
        ::-webkit-scrollbar-thumb { background: var(--secondary); }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary); }
        
        /* Glitch apenas no tema energia */
        body.theme-energia h1 { animation: glitch-text 3s infinite; }
        @keyframes glitch-text {
            0% { text-shadow: 2px 0 var(--highlight), -2px 0 var(--secondary); }
            20% { text-shadow: -2px 0 var(--highlight), 2px 0 var(--secondary); }
            40% { text-shadow: 2px 0 var(--highlight), -2px 0 var(--secondary); }
            100% { text-shadow: 2px 0 var(--highlight), -2px 0 var(--secondary); }
        }

    </style>
</head>
<body>
    <div class="bg-texture"></div>

    <!-- SELETOR DE TEMA (NO CANTO) -->
    <div class="theme-switcher">
        <i class="fas fa-palette text-gray-400"></i>
        <select onchange="changeTheme(this.value)">
            <option value="">MORTE (Padrão)</option>
            <option value="sangue">SANGUE</option>
            <option value="energia">ENERGIA</option>
            <option value="conhecimento">CONHECIMENTO</option>
            <option value="medo">MEDO</option>
        </select>
    </div>

    <!-- Header -->
    <div class="text-center mb-6 z-10 mt-8">
        <h1 id="appTitle">RITUALÍSTICA</h1>
        <h2>SISTEMA DE CONJURAÇÃO</h2>
    </div>

    <div class="device-container rounded">
        
        <!-- Configuração do Roll -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <!-- Seletor de Tipo de Dano -->
            <div>
                <label class="text-xs font-bold opacity-70 mb-1 block" style="color:var(--primary)">TIPO DE DANO / TESTE</label>
                <select id="damageType" class="config-select">
                    <option value="mundano">MUNDANO (Físico)</option>
                    <option value="sangue">SANGUE (Dor)</option>
                    <option value="morte">MORTE (Entropia)</option>
                    <option value="energia">ENERGIA (Caos)</option>
                    <option value="conhecimento">CONHECIMENTO (Saber)</option>
                    <option value="mental">MENTAL (Sanidade)</option>
                    <option value="medo">MEDO (Impossível)</option>
                </select>
            </div>

            <!-- Qtd por Clique -->
            <div>
                <label class="text-xs font-bold opacity-70 mb-1 block" style="color:var(--primary)">DADOS POR CLIQUE</label>
                <div class="flex items-center">
                    <input type="number" id="clickQty" value="1" min="1" max="10" class="config-input">
                </div>
            </div>
        </div>

        <!-- Grid de Dados -->
        <div class="text-xs font-mono opacity-70 mb-2" style="color:var(--highlight)">ADICIONAR DADOS AO POOL</div>
        <div class="dice-grid">
            <button class="dice-btn" onclick="addToPool(4)"><i class="fas fa-play fa-rotate-270 dice-icon"></i>d4</button>
            <button class="dice-btn" onclick="addToPool(6)"><i class="fas fa-cube dice-icon"></i>d6</button>
            <button class="dice-btn" onclick="addToPool(8)"><i class="fas fa-gem dice-icon"></i>d8</button>
            <button class="dice-btn" onclick="addToPool(10)"><i class="fas fa-dice-d10 dice-icon"></i>d10</button>
            <button class="dice-btn" onclick="addToPool(12)"><i class="fas fa-dungeon dice-icon"></i>d12</button>
            <button class="dice-btn" onclick="addToPool(20)"><i class="fas fa-dice-d20 dice-icon"></i>d20</button>
        </div>

        <!-- Pool Display -->
        <div class="control-panel rounded mt-6 p-4" style="border:1px dashed var(--border); background:rgba(0,0,0,0.2)">
            <div class="flex justify-between items-end mb-1">
                <span class="text-xs opacity-70" style="color:var(--text)">FÓRMULA ATUAL</span>
                <span class="text-xs opacity-70" style="color:var(--text)">BÔNUS</span>
            </div>
            
            <div class="flex gap-2">
                <div class="pool-display rounded flex-grow">
                    <span id="poolText">Vazio...</span>
                    <span class="pool-clear" onclick="clearPool()"><i class="fas fa-times"></i></span>
                </div>
                <input type="number" id="diceBonus" value="0" class="config-input w-20 text-lg" onchange="updatePoolDisplay()">
            </div>
        </div>

        <!-- Botão -->
        <button class="action-btn rounded" onclick="rollPool()">CONJURAR</button>

        <!-- Resultado -->
        <div class="result-area rounded" id="resultArea">
            <div class="absolute top-2 left-2 text-xs opacity-50 font-mono" style="color:var(--primary)">RESULTADO</div>
            <div id="finalResult" class="result-val">00</div>
            <div id="resultBreakdown" class="result-breakdown">Aguardando...</div>
        </div>

    </div>

    <!-- Log -->
    <div class="log-container rounded shadow-lg z-10" id="logContainer">
        <div class="log-entry">
            <div class="text-xs opacity-70" style="color:var(--text)">SISTEMA</div>
            <div style="color:var(--highlight)">> Dispositivo pronto. Selecione os dados.</div>
        </div>
    </div>

    <script>
        let dicePool = [];

        // Função para Trocar Tema
        function changeTheme(theme) {
            document.body.className = theme ? `theme-${theme}` : '';
            
            // Atualizar título para dar sabor
            const titles = {
                '': 'RITUALÍSTICA',
                'sangue': 'FLUXO DE SANGUE',
                'energia': 'CAOS DA ENERGIA',
                'conhecimento': 'ORDEM DO SABER',
                'medo': 'O IMPOSSÍVEL'
            };
            document.getElementById('appTitle').innerText = titles[theme] || 'RITUALÍSTICA';
        }

        // Lógica de Dados (Mantida)
        function addToPool(sides) {
            const qty = parseInt(document.getElementById('clickQty').value) || 1;
            for(let i=0; i<qty; i++) dicePool.push(sides);
            dicePool.sort((a,b) => b-a);
            updatePoolDisplay();
        }

        function clearPool() {
            dicePool = [];
            updatePoolDisplay();
        }

        function updatePoolDisplay() {
            const poolText = document.getElementById('poolText');
            const bonus = parseInt(document.getElementById('diceBonus').value) || 0;

            if (dicePool.length === 0) {
                poolText.innerText = "Vazio...";
                poolText.style.opacity = "0.5";
                return;
            }

            const counts = {};
            dicePool.forEach(d => counts[d] = (counts[d] || 0) + 1);

            let parts = [];
            Object.keys(counts).sort((a,b) => b-a).forEach(sides => {
                parts.push(`${counts[sides]}d${sides}`);
            });

            let finalStr = parts.join(' + ');
            if (bonus !== 0) finalStr += ` ${bonus > 0 ? '+' : ''} ${bonus}`;

            poolText.innerText = finalStr;
            poolText.style.opacity = "1";
        }

        function rollPool() {
            if (dicePool.length === 0) return;

            const bonus = parseInt(document.getElementById('diceBonus').value) || 0;
            const resultDisplay = document.getElementById('finalResult');
            
            // Animação
            resultDisplay.style.opacity = "0.5";
            let animationFrames = 0;
            const maxVal = dicePool.reduce((a,b) => a+b, 0) + bonus;

            const animInterval = setInterval(() => {
                resultDisplay.innerText = Math.floor(Math.random() * maxVal);
                animationFrames++;
                if (animationFrames > 8) {
                    clearInterval(animInterval);
                    finalizeRoll(bonus);
                }
            }, 50);
        }

        function finalizeRoll(bonus) {
            const resultDisplay = document.getElementById('finalResult');
            const breakdownDisplay = document.getElementById('resultBreakdown');
            const type = document.getElementById('damageType').value;
            
            let total = 0;
            let rollsDetails = [];
            let crit = false;

            dicePool.forEach(sides => {
                const r = Math.floor(Math.random() * sides) + 1;
                total += r;
                rollsDetails.push(r);
                if (sides === 20 && r === 20) crit = true;
            });

            const finalTotal = total + bonus;

            resultDisplay.style.opacity = "1";
            resultDisplay.innerText = finalTotal;
            
            let bdText = `[${rollsDetails.join('+')}]`;
            if (bonus !== 0) bdText += ` ${bonus > 0 ? '+' : ''}${bonus}`;
            
            let extraHTML = "";
            if(crit) {
                resultDisplay.style.textShadow = "0 0 30px var(--highlight)";
                extraHTML = ` <strong class="text-white bg-red-600 px-1 text-xs rounded">CRÍTICO</strong>`;
            } else {
                resultDisplay.style.textShadow = "0 0 10px var(--shadow-color)";
            }
            
            breakdownDisplay.innerHTML = `${bdText}${extraHTML}`;

            addToLog(document.getElementById('poolText').innerText, rollsDetails, finalTotal, crit, type);
        }

        function addToLog(formula, rolls, total, crit, type) {
            const logContainer = document.getElementById('logContainer');
            const div = document.createElement('div');
            
            const time = new Date().toLocaleTimeString('pt-BR', { hour12: false });
            let critText = crit ? `<span style="color:var(--highlight); font-weight:bold; margin-left:5px">CRÍTICO!</span>` : '';
            
            div.classList.add('log-entry');
            
            div.innerHTML = `
                <div class="flex justify-between items-center mb-1">
                    <span class="text-xs opacity-50" style="color:var(--text)">[${time}]</span>
                    <span class="log-tag tag-${type}">${type.toUpperCase()}</span>
                </div>
                <div class="font-bold text-lg" style="color:var(--highlight)">${formula} ➔ ${total} ${critText}</div>
                <div class="text-xs opacity-50 font-mono tracking-wider" style="color:var(--text)">${rolls.join(' + ')}</div>
            `;

            logContainer.prepend(div);
        }
    </script>
</body>
</html>
